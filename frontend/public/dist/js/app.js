Namespace("App.Controller",{Abstract:Backbone.View.extend({queue:[],addQueue:function(a){this.queue.push(a)},runQueue:function(){_.each(this.queue,_.bind(function(a){a()},this)),this.queue=[]}})}),Namespace("App.Controller",function(){return{MainController:App.Controller.Abstract.extend({initialize:function(){this.selectorControllerFrom=new App.Controller.SelectorController({id:"from"}),this.selectorControllerFrom.on("on:update",this.connectionCheck,this),this.selectorControllerTo=new App.Controller.SelectorController({id:"to"}),this.selectorControllerTo.on("on:update",this.connectionCheck,this),this.connectionIndicatorController=new App.Controller.ConnectionIndicatorController,this.mainMessageController=new App.Controller.MainMessageController,this.connectedListController=new App.Controller.ConnectedListController,this.on("connected_btn:click",_.bind(this.connectedListController.trigger,this.connectedListController,"connected_btn:click")),this.on("connected_btn:click",_.bind(this.trigger,this,"on:connected_btn:click"))},start:function(){this.trigger("get:from_collection",_.bind(this.selectorControllerFrom.trigger,this.selectorControllerFrom,"on:get:from_collection")),this.trigger("get:to_collection",_.bind(this.selectorControllerTo.trigger,this.selectorControllerTo,"on:get:to_collection")),this.connectedListController.trigger("start")},onConnectSuccess:function(){this.connectionIndicatorController.trigger("bounce"),this.mainMessageController.trigger("show:connected",{from:this.selectorControllerFrom.targetData,to:this.selectorControllerTo.targetData})},connectionCheck:function(){null!=this.selectorControllerFrom.targetData&&null!=this.selectorControllerTo.targetData?(this.connectionIndicatorController.trigger("on:connection",{from:this.selectorControllerFrom.targetData,to:this.selectorControllerTo.targetData}),this.trigger("request:connection",{from:this.selectorControllerFrom.targetData,to:this.selectorControllerTo.targetData,success:_.bind(this.onConnectSuccess,this)}),this.selectorControllerFrom.trigger("remove:connected:sign"),this.selectorControllerTo.trigger("remove:connected:sign")):this.connectionIndicatorController.trigger("off:connection")}})}}()),Namespace("App.Controller",function(){return{SelectorController:App.Controller.Abstract.extend({initialize:function(a){this.id=a.id,this.path=[],this.data=[],this.targetData=null,this.on("on:get:from_collection",this.onGetFromCollection,this),this.on("on:get:to_collection",this.onGetToCollection,this),this.on("on:btn:click",this.onBtnClick,this),this.on("on:path:btn:click",this.onPathBtnClick,this),this.on("go:home",this.goHome,this),this.on("remove:connected:sign",_.bind(this.trigger,this,"on:remove:connected:sign"))},onGetFromCollection:function(a){var b=this.sortData(a);this.data=b,this.trigger("render:view",{data:b},"in"),this.trigger("update:breadcrumbs:view",this.path),this.trigger("on:update")},onGetToCollection:function(a){var b=this.sortData(a);this.data=b,this.trigger("render:view",{data:b},"in"),this.trigger("update:breadcrumbs:view",this.path),this.trigger("on:update")},sortData:function(a){var b=this.id,c=_.groupBy(a,function(a){return a.get("level")[0]});return c=_.map(c,function(a,c){var d,e=App.Factory.String.removeQuotation(c);if(d="to"==b?App.Factory.String.convertToFriendlyFloorName(c):c,"to"==b){var f=_.groupBy(a,function(a){return a.get("level")[1]||0/0}),g=_.map(_.values(f.NaN),function(a){return[a]});delete f.NaN,f=_.map(f,function(a){return a}),f=_.union(f,g)}else{var f=_.groupBy(a,function(a){return a.get("friendly_label")});f=_.map(f,function(a){return a})}return f=_.map(f,function(a){return _.size(a)>1?{id:App.Factory.String.convertToSlug(a[0].get("level")[1]),short_name:a[0].get("level")[1],path_name:a[0].get("level")[1],friendly_path_name:a[0].get("level")[1],class_name:"group_"+App.Factory.String.convertToSlug(a[0].get("level")[0]),data:a}:a[0]}),{id:App.Factory.String.convertToSlug(c.replace(/'/g,"")),short_name:e,path_name:e,friendly_path_name:d,class_name:"group_root",data:f}})},onBtnClick:function(a){var b;0==this.path.length?(b=_.find(this.data,function(b){return b.id==a}),console.log(b),b&&(this.path=[],this.path.push({key:a,data:b}))):(b=_.find(this.path[this.path.length-1].data.data,function(b){return b.id==a}),b&&this.path.push({key:a,data:b})),b&&(b instanceof Backbone.Model?(this.updateTarget(b),this.trigger("on:update"),this.trigger("update:view:last",b,"in")):(this.trigger("on:update"),this.trigger("update:view",b,"in")),this.trigger("update:breadcrumbs:view",this.path))},onPathBtnClick:function(a){this.path.splice(a,this.path.length);var b=0==this.path.length?{data:this.data}:this.path[this.path.length-1].data;this.updateTarget(),this.trigger("update:view",b,"out"),this.trigger("update:breadcrumbs:view",this.path),this.trigger("on:update")},goHome:function(){this.onPathBtnClick(0)},updateTarget:function(a){this.targetData=a?a:null}})}}()),Namespace("App.Controller",function(){return{ConnectionIndicatorController:App.Controller.Abstract.extend({initialize:function(){this.on("on:connection",this.onConnection,this),this.on("off:connection",this.offConnection,this),this.on("on:connect:click",this.onConnectClick,this),this.on("bounce",_.bind(this.trigger,this,"do:bounce"))},onConnection:function(){this.trigger("update:view:connect")},offConnection:function(){this.trigger("update:view:disconnect")},onConnectClick:function(){console.log("onConnectClick"),this.trigger("on:connect")}})}}()),Namespace("App.Controller",function(){return{MainMessageController:App.Controller.Abstract.extend({initialize:function(){this.on("show:connected",this.onShowConnected,this)},onShowConnected:function(a){_.delay(_.bind(function(){console.log(a);var b="";_.each(a.from.attributes.level,_.bind(function(c,d){b+=c,d!=a.from.attributes.level.length-1&&(b+=" ")},this)),from_str=b+" - "+a.from.attributes.label;var b="";_.each(a.to.attributes.level,_.bind(function(c,d){0!=d?(b+=c,d!=a.to.attributes.level.length-1&&(b+=" ")):b+=a.to.attributes.friendly_level[0]+" "},this)),to_str=b+" - "+a.to.attributes.label,this.trigger("on:show:connected",{from:from_str,to:to_str})},this),300)}})}}()),Namespace("App.Controller",function(){return{ConnectedListController:App.Controller.Abstract.extend({initialize:function(){this.updateTiming=3e3,this.on("start",this.start,this),this.on("connected_btn:click",_.bind(this.trigger,this,"on:connected_btn:click"))},start:function(){this.update()},resumeTimer:function(){this.timer=setTimeout(_.bind(this.update,this),this.updateTiming)},update:function(){var a={},b=_.bind(function(){if(a.from&&a.to){var b=[];_.each(a.to,function(c){var d=c.clone(),e=_.find(a.from,function(a){return d.get("source")==a.get("id")});null!=e&&(d.set("source_data",e.clone().attributes),e.set("destination_data",c.clone().attributes),c.set("source_data",e.clone().attributes),0!=d.get("source")&&b.push(d))}),this.trigger("update:view",b),this.resumeTimer()}},this);this.once("on:get:from_collection:processed_connected",function(c){a.from=c,b()},this),this.once("on:get:to_collection:processed_connected",function(c){a.to=c,b()},this),this.trigger("get:connected_collection",_.bind(this.trigger,this,"on:get:connected_collection"))}})}}()),Namespace("App.Facade",function(){return{ArcLoadingGraphic:Backbone.View.extend({initialize:function(a){this.el=document.createElement("div"),this.width=a.width,this.height=a.height,this.strokeWidth=3,this.opacity=.8,this.stroke="#00cfbb",TweenLite.set(this.el,{autoAlpha:0}),this.stage=new Kinetic.Stage({container:this.el,width:this.width,height:this.height});var b=new Kinetic.Layer,c=new Kinetic.Arc({x:this.width/2,y:this.height/2,innerRadius:this.width/2-this.strokeWidth/2,outerRadius:this.height/2-this.strokeWidth/2,stroke:this.stroke,strokeWidth:this.strokeWidth,angle:0,opacity:this.opacity,rotationDeg:-90});b.add(c),this.stage.add(b),this.anim=new Kinetic.Animation(function(){var a=c.attrs.angle+8;360>a?c.attrs.angle=a:(c.clockwise(c.clockwise()?!1:!0),c.attrs.angle=.01)},b),this.start()},render:function(){return this.el},start:function(){TweenLite.to(this.el,.3,{autoAlpha:1}),this.anim.start()},end:function(a){var b=a||{};TweenLite.to(this.el,.3,{autoAlpha:0,onComplete:_.bind(function(){this.anim.stop()},this)}),b.onComplete&&b.onComplete.call(this)}})}}()),Namespace("App.Factory",{String:function(){return{convertToSlug:function(a){return null!=a&&""!=a?a.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):""},removeQuotation:function(a){return a.replace(/'/g,"")},convertToFriendlyFloorName:function(a){var b,c=a.replace(/'/g,"").toLowerCase();switch(c){case"b":b="Basement";break;case"g":b="Ground Floor";break;default:b="Floor "+this.toTitleCase(wordMath.toString(c))}return b},toTitleCase:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}}}()}),Namespace("App.Model",{API:function(){return{from:"https://api.videorouter.the-mill.com/router/?input",to:"https://api.videorouter.the-mill.com/router/?output",connect:"https://api.videorouter.the-mill.com/router/",connected:"https://api.videorouter.the-mill.com/router/?output?list"}}()}),Namespace("App.Model",{AbstractModel:Backbone.Model.extend({initialize:function(){this.queue=[]},addQueue:function(a){this.queue.push(a)},runQueue:function(){_.each(this.queue,_.bind(function(a){a()},this)),this.queue=[]}})}),Namespace("App.Model",{AbstractCollection:Backbone.Collection.extend({initialize:function(){this.queue=[]},addQueue:function(a){this.queue.push(a)},runQueue:function(){_.each(this.queue,_.bind(function(a){a()},this)),this.queue=[]}})}),Namespace("App.Model",{MainModel:App.Model.AbstractModel.extend({initialize:function(a){App.Model.AbstractModel.prototype.initialize.call(this);var b=a.mainController;this.fromCollection=new App.Model.FromCollection({},{mainController:b}),this.toCollection=new App.Model.ToCollection({},{mainController:b}),this.connectedCollection=new App.Model.ConnectedCollection({},{mainController:b}),this.connectRequest=new App.Model.ConnectRequest({},{mainController:b})}})}),Namespace("App.Model",{FromModel:Backbone.Model.extend({urlRoot:App.Model.API.from,initialize:function(){},getData:function(){},onGetData:function(){},onError:function(a){console.error(a)}})}),Namespace("App.Model",{FromCollection:App.Model.AbstractCollection.extend({url:App.Model.API.from,model:App.Model.FromModel,initialize:function(a,b){App.Model.AbstractCollection.prototype.initialize.call(this),this.loading=!1,this.loaded=!1,this.mainController=b.mainController,this.mainController.on("get:from_collection",this.getData,this),this.mainController.connectedListController.on("on:get:connected_collection",this.onGetConnected,this)},onGetConnected:function(a){!this.loading&&this.loaded?this.postProcessConnected(a):this.addQueue(_.bind(this.postProcessConnected,this,a))},postProcessConnected:function(a){_.each(this.models,function(b){var c=_.find(a,function(a){return a.get("source")==b.get("id")});null!=c&&(b.set("connected_to",c.get("uid")),b.set("created",c.get("created")))}),this.mainController.connectedListController.trigger("on:get:from_collection:processed_connected",this.models)},createItemObj:function(a){return a},parse:function(a){var b=[];return console.log(a.input),_.each(a.input,_.bind(function(a,c){_.isEmpty(a)||_.each(a,_.bind(function(a,d){_.size(a.data)>1?_.each(a.data,_.bind(function(e){b.push(this.createItemObj({id:d+e.port_uid,port_uid:e.port_uid,friendly_label:d,level:[c,a.label],label:e.sublevel_label,locked:e.locked}))},this)):(a.data=_.map(a.data,function(a){return a}),b.push(this.createItemObj({id:d+a.data[0].port_uid,port_uid:a.data[0].port_uid,friendly_label:d,short_label:a.label,level:[c],label:d,locked:a.data[0].locked})))},this))},this)),b},getData:function(a){this.loading=!0,this.loaded=!1,this.fetch({success:_.bind(this.onGetData,this,a),error:_.bind(this.onError,this)})},onGetData:function(a){this.loading=!1,this.loaded=!0,this.runQueue(),a.call(this,this.models)},onError:function(a){console.error(a)}})}),Namespace("App.Model",{ToModel:Backbone.Model.extend({urlRoot:App.Model.API.to,initialize:function(){},getData:function(){},onGetData:function(){},onError:function(a){console.error(a)}})}),Namespace("App.Model",{ToCollection:App.Model.AbstractCollection.extend({url:App.Model.API.to,model:App.Model.ToModel,initialize:function(a,b){App.Model.AbstractCollection.prototype.initialize.call(this),this.loading=!1,this.loaded=!1,this.mainController=b.mainController,this.mainController.on("get:to_collection",this.getData,this),this.mainController.connectedListController.on("on:get:connected_collection",this.onGetConnected,this)},onGetConnected:function(a){!this.loading&&this.loaded?this.postProcessConnected(a):this.addQueue(_.bind(this.postProcessConnected,this,a))},postProcessConnected:function(a){_.each(this.models,function(b){var c=_.find(a,function(a){return a.get("uid")==b.get("id")});null!=c&&(b.set("source",c.get("source")),b.set("created",c.get("created")))}),this.mainController.connectedListController.trigger("on:get:to_collection:processed_connected",this.models)},createItemObj:function(a){return a},parse:function(a){var b=[];return _.each(a.output,_.bind(function(a,c){var d=(App.Factory.String.removeQuotation(c),App.Factory.String.convertToFriendlyFloorName(c));_.isEmpty(a)||_.each(a,_.bind(function(a,e){_.size(a.data)>1?_.each(a.data,_.bind(function(f){null!=f.data?f.data.label:e;b.push(this.createItemObj({id:f.port_uid,level:[c,e],friendly_level:[d,e],label:f.sublevel_label,friendly_label:a.friendly_label}))},this)):(a.data=_.map(a.data,function(a){return a}),b.push(this.createItemObj({id:a.data[0].port_uid,friendly_label:a.friendly_label,level:[c],friendly_level:[d],label:e})))},this))},this)),b},getData:function(a){this.loading=!0,this.loaded=!1,this.fetch({success:_.bind(this.onGetData,this,a),error:_.bind(this.onError,this)})},onGetData:function(a){this.loading=!1,this.loaded=!0,this.runQueue(),a.call(this,this.models)},onError:function(a){console.error(a)}})}),Namespace("App.Model",{ConnectRequest:Backbone.Model.extend({requestUrl:App.Model.API.connect,initialize:function(a,b){this.mainController=b.mainController,this.mainController.on("request:connection",this.connect,this),this.options={url:this.requestUrl,type:"POST",dataType:"json",wait:!1,reset:!0,error:_.bind(this.onError,this)}},connect:function(a){var b=a.from,c=a.to,d={input_port:b.get("port_uid"),output_port:c.get("id")};console.log(d),this.options.data=d,this.options.success=_.bind(this.onConnect,this,a.success),this.fetchXhr=Backbone.ajax(this.options)},onConnect:function(a,b){console.log(b),"OK: Setting route completed"==b[0]&&a.call(this)},onError:function(){}})}),Namespace("App.Model",{ConnectedModel:Backbone.Model.extend({urlRoot:App.Model.API.connected,initialize:function(){},getData:function(){},onGetData:function(){},onError:function(a){console.error(a)}})}),Namespace("App.Model",{ConnectedCollection:Backbone.Collection.extend({url:App.Model.API.connected,model:App.Model.ConnectedModel,initialize:function(a,b){this.mainController=b.mainController,this.mainController.connectedListController.on("get:connected_collection",this.getData,this)},parse:function(a){var b=[];return _.each(a.output,function(a){_.each(a,function(a){var c={uid:a.Id,source:a.Source,label:a.Label,floor:a.Floor,hardware:a.Hardware,created:a.Created};b.push(c)})}),b},getData:function(a){this.fetch({success:_.bind(this.onGetData,this,a),error:_.bind(this.onError,this)})},onGetData:function(a){a&&a.call(this,this.models)},onError:function(a){console.error(a)}})}),Namespace("App.View",{Abstract:Backbone.View.extend({switchView:function(a,b){var c=0;_.each(this.viewSwitcher,_.bind(function(d){d.rendered&&(c+=1,d.once("on:end",_.bind(this.switchView,this,a,b)),d.trigger("end"))},this)),0==c&&_.each(this.viewSwitcher,_.bind(function(c){c.id==a&&(c.trigger("start",b),this.trigger("view:switched",b))},this))},initialize:function(){this.queue=[]},addQueue:function(a){this.queue.push(a)},runQueue:function(){_.each(this.queue,_.bind(function(a){a()},this)),this.queue=[]}})}),Namespace("App.View",{MainView:App.View.Abstract.extend({html:document.getElementById("T_MainView").text,rendered:!1,initialize:function(a){this.$ctr=a.$ctr,this.mainController=a.mainController,this.mainController.on("on:connected_btn:click",this.onConnectedBtnClick,this),this.render()},render:function(){if(!this.rendered){this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el);var a=$("._message_ctr",this.$el),b=$("._selection_from_ctr",this.$el),c=$("._connection_indicator_ctr",this.$el),d=$("._selection_to_ctr",this.$el);this.$connected_list_ctr=$("._connected_list_ctr",this.$el);var e=$("._connected_btn",this.$el);Hammer(e[0]).on("tap",_.bind(this.mainController.trigger,this.mainController,"connected_btn:click"));var f=$("._list_ctr",this.$el),g=$("._overlay",this.$el);Hammer(g[0]).on("tap",_.bind(this.onConnectedBtnClick,this));{new App.View.ConnectionsDropdownView({$ctr:f,connectedListController:this.mainController.connectedListController}),new App.View.MainMessageView({$ctr:a,mainMessageController:this.mainController.mainMessageController}),new App.View.SelectorView({id:"from",$ctr:b,selectorController:this.mainController.selectorControllerFrom}),new App.View.SelectorView({id:"to",$ctr:d,selectorController:this.mainController.selectorControllerTo}),new App.View.ConnectionIndicatorView({$ctr:c,connectionIndicatorController:this.mainController.connectionIndicatorController})}}},onConnectedBtnClick:function(){this.$el.hasClass("open")?this.$el.removeClass("open"):this.$el.addClass("open")}})}),Namespace("App.View",{SelectorView:App.View.Abstract.extend({rendered:!1,html:document.getElementById("T_SelectorCtrView").text,selector_html:document.getElementById("T_SelectorView").text,initialize:function(a){App.View.Abstract.prototype.initialize.call(this),this.selectorController=a.selectorController,this.$ctr=a.$ctr,this.id=a.id,this.rendered=!1,this.ctrArray=[],this.btnViews=[],this.paneViews=[],this.listenTo(this.selectorController,"render:view",_.bind(this.draw,this,!1)),this.listenTo(this.selectorController,"update:view",_.bind(this.draw,this,!1)),this.listenTo(this.selectorController,"update:view:last",_.bind(this.draw,this,!0)),this.listenTo(this.selectorController,"update:view",_.bind(this.onSelection,this,!1)),this.listenTo(this.selectorController,"update:view:last",_.bind(this.onSelectionLast,this,!0)),this.listenTo(this.selectorController,"on:remove:connected:sign",_.bind(this.onRemoveConnectedSign,this)),this.render()},render:function(){this.$el=$(_.template(this.html,{})),this.$path_ctr=$("._path_ctr",this.$el),this.$message_ctr=$("._message_ctr",this.$el),this.$pane_ctr=$("._pane_ctr",this.$el),this.$ctr.append(this.$el),this.breadcrumbs=new App.View.BreadcrumbsView({selectorController:this.selectorController,$ctr:this.$path_ctr}),this.selectorMessageView=new App.View.SelectorMessageView({selectorController:this.selectorController,$ctr:this.$message_ctr})},onSelection:function(){this.$el.removeClass("black")},onSelectionLast:function(){this.$el.addClass("black")},onRemoveConnectedSign:function(){0==this.paneViews.length?this.addQueue(_.bind(this.removeConnectedSign,this)):this.removeConnectedSign()},removeConnectedSign:function(){console.log("removeConnectedSign"),_.each(this.paneViews,_.bind(function(a){a.removeConnectedSign()},this))},draw:function(a,b,c){if(this.ctrArray.length>0){var d="in"==c?5:-5;TweenLite.to(this.ctrArray[0],.2,{z:d,opacity:0,onComplete:_.bind(this.onPreviousFadeout,this,a,b,c)})}else{this.resetViews();var e=$(_.template(this.selector_html,{}));if(this.$pane_ctr.append(e),a){var f=new App.View.SingleItemView({id:this.id,selectorController:this.selectorController,model:b});e.append(f.render()),f.init(),this.paneViews.push(f),this.runQueue(),this.ctrArray.push(e);var d="in"==c?-5:5;TweenLite.set(e,{transformPerspective:100,transformOrigin:"50% 50%",z:d,opacity:0}),TweenLite.to(e,.3,{z:0,opacity:1})}else{var g,h=_.size(b.data);6>=h&&(g="two"),h>6&&12>=h&&(g="three"),h>12&&(g="three"),_.each(b.data,_.bind(function(a,b){var c=new App.View.SingleBtnView({groupClass:a.class_name,btnClass:g,selectorController:this.selectorController,data:a,key:b});e.append(c.render()),this.btnViews.push(c)},this)),this.ctrArray.push(e);var d="in"==c?-5:5;TweenLite.set(e,{transformPerspective:100,transformOrigin:"50% 50%",z:d,opacity:0}),TweenLite.to(e,.3,{z:0,opacity:1})}}},resetViews:function(){_.each(this.btnViews,function(a){a.destroy()}),_.each(this.paneViews,function(a){a.remove()}),this.btnViews=[],this.paneViews=[]},onPreviousFadeout:function(a,b,c){this.ctrArray[0].remove(),this.ctrArray.shift(),this.draw(a,b,c)}})}),Namespace("App.View",{MainMessageView:App.View.Abstract.extend({html:document.getElementById("T_MainMessageView").text,initialize:function(a){this.mainMessageController=a.mainMessageController,this.$ctr=a.$ctr,this.mainMessageController.on("on:show:connected",this.showOnConnection,this),this.render()},render:function(){this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el),this.$message_type_1=$("._message_type_1",this.$el),TweenLite.set(this.$message_type_1,{autoAlpha:0}),this.$from_text=$("._from_text",this.$el),this.$to_text=$("._to_text",this.$el)},showOnConnection:function(a){if(null!=this.$message_type_1[0]._gsTransform&&-10!=this.$message_type_1[0]._gsTransform.y)TweenLite.killTweensOf(this.$message_type_1),TweenLite.to(this.$message_type_1,.5,{autoAlpha:0,y:-10,onComplete:_.bind(this.showOnConnection,this,a)});else{var b=a.from,c=a.to;this.$from_text.html(b),this.$to_text.html(c),TweenLite.killTweensOf(this.$message_type_1),TweenLite.set(this.$message_type_1,{y:10}),TweenLite.to(this.$message_type_1,.5,{autoAlpha:1,y:0})}}})}),Namespace("App.View",{ConnectionsDropdownView:App.View.Abstract.extend({html:document.getElementById("T_ConnectionsDropdownView").text,initialize:function(a){this.$ctr=a.$ctr,this.connectedListController=a.connectedListController,this.connectedListController.on("update:view",this.update,this),this.groupViews=[],this.render()},render:function(){this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el),this.$list_ctr=$("._list_ctr",this.$el)},update:function(a){this.$list_ctr.empty();var b=_.groupBy(a,function(a){return a.get("level")[0]});_.each(b,_.bind(function(a,b){var c,d=b.replace(/'/g,"").toLowerCase();switch(d){case"b":c="Basement";break;case"g":c="Ground Floor";break;default:c="Floor "+wordMath.toString(d)}var e=new App.View.ConnectedGroupView({$ctr:this.$list_ctr,connectedListController:this.connectedListController,label:c,models:a});this.groupViews.push(e)},this))}})}),Namespace("App.View",{ConnectedGroupView:App.View.Abstract.extend({html:document.getElementById("T_ConnectedGroupView").text,initialize:function(a){this.connectedListController=a.connectedListController,this.label=a.label,this.models=a.models,this.$ctr=a.$ctr,this.views=[],this.render()},render:function(){this.$el=$(_.template(this.html,{data:{label:this.label}})),this.$ctr.append(this.$el);var a=$("._group_list_ctr",this.$el);_.each(this.models,_.bind(function(b){new App.View.SingleConnectedView({connectedListController:this.connectedListController,$ctr:a,model:b})},this))}})}),Namespace("App.View",{SingleConnectedView:App.View.Abstract.extend({html:document.getElementById("T_SingleConnectedView").text,initialize:function(a){this.$ctr=a.$ctr,this.model=a.model,this.connectedListController=a.connectedListController,this.render()},render:function(){var a={};if(this.model.attributes.friendly_level.length>1){var b="";_.each(this.model.attributes.friendly_level,_.bind(function(a,c){0!=c&&(b+=a,c!=this.model.attributes.friendly_level.length-1&&(b+=" "))},this)),a.to_text=b+" - "+this.model.attributes.label}else a.to_text=this.model.attributes.label;var b="";if(_.each(this.model.attributes.source_data.level,_.bind(function(a,c){b+=a,c!=this.model.attributes.source_data.level.length-1&&(b+=" ")},this)),null!=this.model.attributes.created)if(0==this.model.attributes.created)var c="";else var c=moment(1e3*this.model.attributes.created).fromNow();var d=c;a.from_text=b+" - "+this.model.attributes.source_data.label,a.time_str=d,this.$el=$(_.template(this.html,{data:this.model.attributes,data_modified:a})),this.$ctr.append(this.$el)}})}),Namespace("App.View",{ConnectionIndicatorView:App.View.Abstract.extend({html:document.getElementById("T_ConnectionIndicatorView").text,rendered:!1,initialize:function(a){this.connectionIndicatorController=a.connectionIndicatorController,this.listenTo(this.connectionIndicatorController,"update:view:connect",_.bind(this.onConnect,this)),this.listenTo(this.connectionIndicatorController,"update:view:disconnect",_.bind(this.onDisconnect,this)),this.listenTo(this.connectionIndicatorController,"do:bounce",_.bind(this.bounce,this)),this.$ctr=a.$ctr,this.render()},render:function(){this.rendered||(this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el),this.$connected_btn=$("._connected_btn",this.$el),this.$not_connected_btn=$("._not_connected_btn",this.$el),Hammer(this.$connected_btn[0]).on("tap",_.bind(this.connectionIndicatorController.trigger,this.connectionIndicatorController,"on:connect:click")))},onConnect:function(){this.$connected_btn.addClass("active"),this.$not_connected_btn.removeClass("active")},onDisconnect:function(){this.$connected_btn.removeClass("active"),this.$not_connected_btn.addClass("active")},bounce:function(){this.tl=new TimelineLite({onComplete:function(){}}),this.tl.add(TweenLite.to(this.$connected_btn,.4,{scale:1.3,ease:Quad.easeOut})),this.tl.add(TweenLite.to(this.$connected_btn,.3,{scale:1,ease:Bounce.easeOut})),this.tl.play()}})}),Namespace("App.View",{SelectorMessageView:App.View.Abstract.extend({html:document.getElementById("T_SelectorMessageView").text,rendered:!1,initialize:function(a){this.selectorController=a.selectorController,this.listenTo(this.selectorController,"update:breadcrumbs:view",_.bind(this.draw,this)),this.$ctr=a.$ctr,this.render()},render:function(){this.rendered||(this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el))},draw:function(a){if("from"==this.selectorController.id){if(0==a.length)return void this.$el.html('choose your <span class="orange">machine type</span>');if(1==a.length)return void this.$el.html('choose your <span class="orange">machine No.</span>')}if("to"==this.selectorController.id){if(0==a.length)return void this.$el.html('choose destination <span class="orange">floor</span>');if(1==a.length)return void this.$el.html('choose <span class="orange">destination</span>')}return a.length>0?void this.$el.html(""):void 0}})}),Namespace("App.View",{SingleBtnView:App.View.Abstract.extend({html:document.getElementById("T_SingleBtnView").text,rendered:!1,initialize:function(a){this.selectorController=a.selectorController,this.key=a.key,this.data=a.data,this.groupClass=a.groupClass,this.btnClass=a.btnClass},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},render:function(){var a,b={};if(this.data instanceof Backbone.Model){var c=this.data.get("short_label")||this.data.get("label"),d=this.isNumber(c),e=c.split(",");text_html="",_.each(e,function(a){text_html+=a+"<br/>"}),b.text=text_html,a={id:this.data.get("id"),short_name:c}}else{var c=this.data.short_name,d=this.isNumber(c),e=c.split(",");text_html="",_.each(e,function(a){text_html+=a+"<br/>"}),b.text=text_html,a={id:this.data.id,short_name:c}}if(this.$el=$(_.template(this.html,{data:a,data_modified:b})),this.$el.addClass(this.data.id),this.$el.addClass(this.groupClass),this.$el.addClass(this.btnClass),this.$el.addClass("B"==c||"G"==c?"number":d?"number":"string"),this.data instanceof Backbone.Model){var f=this.data.get("locked");_.isEmpty(f)?Hammer(this.$el[0]).on("tap",_.bind(this.selectorController.trigger,this.selectorController,"on:btn:click",this.data.id)):this.$el.addClass("locked")}else{var f=this.checkChildrenlocked(this.data);f?this.$el.addClass("locked"):Hammer(this.$el[0]).on("tap",_.bind(this.selectorController.trigger,this.selectorController,"on:btn:click",this.data.id))}return this.$el},checkChildrenlocked:function(a){var b=[];return _.isArray(a.data)&&_.each(a.data,_.bind(function(a){if(a instanceof Backbone.Model){var c=a.get("locked");_.isEmpty(c)&&b.push(a)}else _.isArray(a.data)&&_.each(a.data,_.bind(function(a){if(a instanceof Backbone.Model){var c=a.get("locked");_.isEmpty(c)&&b.push(a)}else;},this))},this)),b.length>0?!1:!0},destroy:function(){Hammer(this.$el[0]).off("tap"),this.remove()}})}),Namespace("App.View",{SingleItemView:App.View.Abstract.extend({html:document.getElementById("T_SingleItemView").text,initialize:function(a){App.View.Abstract.prototype.initialize.call(this),this.selectorController=a.selectorController,this.id=a.id,this.key=a.key,this.model=a.model,this.rendered=!1},render:function(){var a=this.model.attributes,b={};if(a.type=this.id,"from"==this.id){var c=null!=this.model.attributes.short_label?this.model.attributes.short_label.split(","):this.model.attributes.level[this.model.attributes.level.length-1].split(",");text_html="",_.each(c,function(a){text_html+=a+"<br/>"}),b.text=text_html}if("to"==this.id){var d=a.level[0].replace(/'/g,"").toLowerCase();"b"==d||"g"==d?("b"==d&&(a.title="",a.short_name_en="basement"),"g"==d&&(a.title="",a.short_name_en="ground floor")):(a.title="floor",a.short_name_en=wordMath.toString(a.level[0].replace(/'/g,"")));var c=null!=this.model.attributes.friendly_level[1]?this.model.attributes.friendly_level[1].split(","):this.model.attributes.label.split(",");text_html="",_.each(c,function(a){text_html+=a+"<br/>"}),b.text=text_html}return this.$el=$(_.template(this.html,{data:this.model.attributes,data_modified:b})),this.$el.addClass(this.id),"from"==this.id,"to"==this.id,this.$currently_connected=$("._currently_connected",this.$el),this.$el},init:function(){this.runQueue(),this.rendered=!0},removeConnectedSign:function(){this.rendered?this.$currently_connected.html(""):this.addQueue(_.bind(function(){this.$currently_connected.html("")},this))}})}),Namespace("App.View",{BreadcrumbsView:App.View.Abstract.extend({html:document.getElementById("T_BreadcrumbsView").text,initialize:function(a){this.selectorController=a.selectorController,this.listenTo(this.selectorController,"update:breadcrumbs:view",_.bind(this.draw,this)),this.$ctr=a.$ctr,this.render()},render:function(){this.$el=$(_.template(this.html,{})),this.$ctr.append(this.$el),this.$path_ctr=$("._path_ctr",this.$el),this.$home_btn=$("._home_btn",this.$el),Hammer(this.$home_btn[0]).on("tap",_.bind(this.selectorController.trigger,this.selectorController,"on:path:btn:click",0))},draw:function(a){this.$path_ctr.empty(),0==_.size(a)?this.$home_btn.addClass("active"):this.$home_btn.removeClass("active"),_.each(a,_.bind(function(b,c){var d;d=b.data instanceof Backbone.Model!=1?$("<div>",{"class":"crumb",html:b.data.friendly_path_name.replace(/,/g,"")}):$("<div>",{"class":"crumb",html:b.data.get("label").replace(/,/g,"")}),this.$path_ctr.append(d),c!=a.length-1?Hammer(d[0]).on("tap",_.bind(this.selectorController.trigger,this.selectorController,"on:path:btn:click",c+1)):d.addClass("active")},this))}})}),function(a){var b=function(){var a=function(){{var a=new App.Controller.MainController;new App.Model.MainModel({mainController:a}),new App.View.MainView({$ctr:$(document.body),mainController:a})}a.start()};return{init:a}}();$(a).on("ready",b.init)}(window);